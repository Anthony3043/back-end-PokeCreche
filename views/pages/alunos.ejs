<% const currentPage = 'alunos' %>

<div class="balao-principal">
    <h1>Cadastro do Aluno</h1>

    <div class="balao-topo">
        <button type="button" class="botao-Aluno <%= currentPage === 'alunos' ? 'active' : '' %>" 
                onclick="location.href='/alunos'">Aluno</button>
        <button type="button" class="botao-Professor <%= currentPage === 'docentes' ? 'active' : '' %>" 
                onclick="location.href='/docentes'">Docente</button>
    </div>

    <div class="balao-interno">
        <form id="form-aluno" action="#" method="post">
            <input type="text" placeholder="Nome" name="nome" required />
            <input type="text" placeholder="CPF" name="cpf" required />
            <input type="text" placeholder="Nº Matrícula" name="matricula" required />

            <button type="submit" class="btn-submit">Cadastrar</button>
        </form>
        
        <div id="message-aluno" class="message"></div>
    </div>
</div>

<script>
    // BASE URL DINÂMICA DO EJS
    const baseUrl = '<%= baseUrl %>';
    
    document.getElementById('form-aluno').addEventListener('submit', async function (e) {
        e.preventDefault();
        const form = e.target;
        const btn = form.querySelector('.btn-submit');
        const messageDiv = document.getElementById('message-aluno');
        
        // Loading state
        btn.disabled = true;
        btn.textContent = 'Enviando...';
        messageDiv.innerHTML = '';
        
        const data = {
            nome: form.nome.value.trim(),
            cpf: form.cpf.value.trim(),
            matricula: form.matricula.value.trim()
        };

        try {
            console.log('Enviando para:', baseUrl + '/register/aluno');
            console.log('Dados:', data);
            const res = await fetch('/register/aluno', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            
            const json = await res.json();
            
            if (res.ok) {
                messageDiv.innerHTML = `<div class="success">✅ ${json.message || 'Aluno cadastrado com sucesso!'}</div>`;
                form.reset();
            } else {
                throw json;
            }
        } catch (err) {
            messageDiv.innerHTML = `<div class="error">❌ ${err.message || 'Erro ao cadastrar aluno'}</div>`;
        } finally {
            btn.disabled = false;
            btn.textContent = 'Cadastrar';
        }
    });
</script>